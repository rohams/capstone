<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="css/mystyle.css">
<script src="scripts/script.js"></script>
<script src="scripts/testScript.js"></script>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script type="text/javascript"
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxfWoChDI1GdE2uBRUcl17cbjocx6qcs0&sensor=false">
</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/jquery.csv-0.71.js"></script>
<script src="scripts/import.js"></script>
<script type="text/javascript">

  $(document).ready(function() {
 $('body').on("click", '#control4', function() {
     //$("#panel6").slideToggle("fast");
     document.getElementById("panel6").style.display = 'block';
     
  });
  $('body').on("click", '#panel1', function() {
     $("#panel3").slideToggle("fast");
     //document.getElementById("panel6").style.display = 'block'; 
  });
    $('body').on("click", '#panel44', function() {
     $("#panel4").slideToggle("fast");
  });
    $('body').on("click", '#panel55', function() {
     $("#panel5").slideToggle("fast");
  });
      $('body').on("click", '#panel99', function() {
     $("#panel9").slideToggle("fast");
  });
});

   //sub-networks  
  $('#sub_id0').live('change', function(){
    if($(this).is(':checked')){
        addMarkers(0);
    } else {
        removeMarkers(0);
    }
});

  $('#sub_id1').live('change', function(){
    if($(this).is(':checked')){
        addMarkers(1);
    } else {
        removeMarkers(1);
    }
});

  $('#sub_id2').live('change', function(){
    if($(this).is(':checked')){
        addMarkers(2);
    } else {
        removeMarkers(2);
    }
});

  $('#sub_id3').live('change', function(){
    if($(this).is(':checked')){
        addMarkers(3);
    } else {
        removeMarkers(3);
    }
});

  $('#sub_id4').live('change', function(){
    if($(this).is(':checked')){
        addMarkers(4);
    } else {
        removeMarkers(4);
    }
});

  $('#sub_id5').live('change', function(){
    if($(this).is(':checked')){
        addMarkers(5);
    } else {
        removeMarkers(5);
    }
});

  $('#sub_id6').live('change', function(){
    if($(this).is(':checked')){
        addMarkers(6);
    } else {
        removeMarkers(6);
    }
});

  $('#sub_id7').live('change', function(){
    if($(this).is(':checked')){
        addMarkers(7);
    } else {
        removeMarkers(7);
    }
});

  $('#sub_id8').live('change', function(){
    if($(this).is(':checked')){
        addMarkers(8);
    } else {
        removeMarkers(8);
    }
});

  $('#sub_id9').live('change', function(){
    if($(this).is(':checked')){
        addMarkers(9);
    } else {
        removeMarkers(9);
    }
});
   //commodity
  $('#ch_cmd_0').live('change', function(){
    if($(this).is(':checked')){
        w_ambient=1;
    } else {
        w_ambient=0;
    }
    updateWeights();
});

  $('#ch_cmd_1').live('change', function(){
    if($(this).is(':checked')){
        w_frozen =1;
    } else {
        w_frozen=0;
    }
    updateWeights();
});

  $('#ch_cmd_2').live('change', function(){
    if($(this).is(':checked')){
        w_perishable=1;
    } else {
        w_perishable=0;
    }
    updateWeights();
});

   //commodity by volume
  $('#ch_cmd_c0').live('change', function(){
    if($(this).is(':checked')){
        v_ambient=1;
    } else {
        v_ambient=0;
    }
    updateWeights();
});

  $('#ch_cmd_c1').live('change', function(){
    if($(this).is(':checked')){
        v_frozen =1;
    } else {
        v_frozen=0;
    }
    updateWeights();
});

  $('#ch_cmd_c2').live('change', function(){
    if($(this).is(':checked')){
        v_perishable=1;
    } else {
        v_perishable=0;
    }
    updateWeights();
});

    //weekdays
     $('#ch_day_0').live('change', function(){
    if($(this).is(':checked')){
        sun=1;
    } else {
        sun=0;
    }
    updateWeights();
});
     $('#ch_day_1').live('change', function(){
    if($(this).is(':checked')){
        mon=1;
    } else {
        mon=0;
    }
    updateWeights();
});
     $('#ch_day_2').live('change', function(){
    if($(this).is(':checked')){
        tue=1;
    } else {
        tue=0;
    }
    updateWeights();
});
     $('#ch_day_3').live('change', function(){
    if($(this).is(':checked')){
        wed=1;
    } else {
        wed=0;
    }
    updateWeights();
});
     $('#ch_day_4').live('change', function(){
    if($(this).is(':checked')){
        thu=1;
    } else {
        thu=0;
    }
    updateWeights();
});
     $('#ch_day_5').live('change', function(){
    if($(this).is(':checked')){
        fri=1;
    } else {
        fri=0;
    }
    updateWeights();
});
     $('#ch_day_6').live('change', function(){
    if($(this).is(':checked')){
        sat=1;
    } else {
        sat=0;
    }
    updateWeights();
});
            
    //****** global variables ******
    var CANADA = new google.maps.LatLng(54.36775852406841, -97.20703125); 
    var MAX_WEIGHT = 1000000;
    //all the visible stores on the map
    var stores = [];
    //all the imported stores from the first file
    var imported = [];
    //all the weights assigned to each store 
    var weights = [];
    //total weight assigned to each store for the selected cmd and weekday
    var tot_weights = [];
    //sub networks
    var subs = [];
    //all the consecutive conturs related to one drawing
    var shapes = [];
    var manual_add_id=0;
    var imp1 = false;
    var max_weight= 1;
    var norm_weight_ave= 1;
    var pathInfos = [];
    var AVE_ZINDEX = 200;
    var addAppend = false;
    var drawAppend = false;
    var DST_CST_RATIO = 0.001;
    var image1 = 'images/marker.png';
    var image2 = 'images/marker2.png';
    var geocoder;
    var aveMarker;
    var openedInfoWindow = null;
    var map;
    var DC;
    var sun=0,mon=0,tue=0,wed=0,thu=0,sat=0,fri=0;
    var w_ambient=0,w_frozen=0,w_perishable=0;
    var v_ambient=0,v_frozen=0,v_perishable=0;
    var markers = [];
    var FW_marker;
    var dcmarker;

    // initialize the map    
function initialize() {
    geocoder = new google.maps.Geocoder();
    
    //map options
    var mapOptions = {
    center: CANADA,
    zoom: 4,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    mapTypeControl: true,
    mapTypeControlOptions: {
    style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
    },
    streetViewControl: false,
    scaleControl: true,
    scaleControlOptions:{
    position: google.maps.ControlPosition.TOP_CENTER
    },
    panControl: true,
    panControlOptions: {
    position: google.maps.ControlPosition.RIGHT_TOP,
    },
    zoomControl: true,
    zoomControlOptions: {
    style: google.maps.ZoomControlStyle.DEFAULT,
    position: google.maps.ControlPosition.RIGHT_TOP
    }
    };
    map = new google.maps.Map(document.getElementById("map-canvas"),
                                  mapOptions);
                                  
 
    // Set info window anywhere the mouse click showing the LatLng of that point.
    var infoWindow = new google.maps.InfoWindow();
    google.maps.event.addListener(map, 'click', function(event) {
								  if (openedInfoWindow != null) {
									  openedInfoWindow.close();
								  }
                                  var dist = SumOfDistances(stores, event.latLng.lat(), event.latLng.lng());
                                  var cost = dist/DST_CST_RATIO;
                                  var html = '' + event.latLng +  "<br/>Cost: " + cost;
                                  infoWindow.setContent(html);
                                  infoWindow.setPosition(event.latLng);
                                  infoWindow.open(map);
                                  openedInfoWindow = infoWindow;
                                  });                             

    //set controls
    var control1 = document.createElement('DIV');
    control1.setAttribute("id", "control1");
    control1.style.padding = '5px';
    control1.style.border = '1px solid #000';
    control1.style.backgroundColor = 'white';
    control1.style.cursor = 'pointer';
    control1.innerHTML = 'Draw Ellipse';
    control1.title = 'draw cost based ellipse';
    control1.index = 1;

    var control2 = document.createElement('DIV');
    control2.setAttribute("id", "control2");
    control2.style.padding = '5px';
    control2.style.border = '1px solid #000';
    control2.style.backgroundColor = 'white';
    control2.style.cursor = 'pointer';
    control2.innerHTML = 'Find Average';
    control2.title = 'mark the weighted average of the nodes';
    control2.index = 2;
    
    var control3 = document.createElement('DIV');
    control3.setAttribute("id", "control3");
    control3.style.padding = '5px';
    control3.style.border = '1px solid #000';
    control3.style.backgroundColor = 'white';
    control3.style.cursor = 'pointer';
    control3.innerHTML = 'Add a Store';
    control3.title = 'Add a new node to the network';
    control3.index = 3;

    var control4 = document.createElement('DIV');
    control4.setAttribute("id", "control4");
    control4.style.padding = '5px';
    control4.style.border = '1px solid #000';
    control4.style.backgroundColor = 'white';
    control4.style.cursor = 'pointer';
    control4.innerHTML = 'Store Optimiz';
    control4.title = 'add the next most optimal store';
    control4.index = 4;

    //draw ellipses
    google.maps.event.addDomListener(control1, 'click', function() {                        
                          if(!drawAppend){
                            //REMOVE STORE OPT ELEMENTs
                            document.getElementById("panel6").style.display = 'none'; 
                            if(addAppend){
                            //REMOVE ADD A NODE ELEMENTS
                            var div = document.getElementById("add_node");
                            if (div!=null){
                            var parent = document.getElementById("panel2");
                            parent.removeChild(div);
                            addAppend = false;
                            }
                            }
                            // ADD NEW ELEMENTS
                            var button = document.createElement("BUTTON");
                            button.innerHTML = 'Enter';
                            button.id = "draw";
                            //LOADING
                            var textnode=document.createTextNode("Loading...");                         
                            var loadprt = document.getElementById("panel2");
                            button.onclick = function(){
                                document.getElementById("panel2").appendChild(textnode);
                                setTimeout(function() {                                   
                                    getEllipse(stores, map);
                                    loadprt.removeChild(textnode);
                                    
                                }, 0);
                              };
                            var node = document.createElement("DIV");
                            node.id = "draw_ellipse";
                            var input1 = document.createElement("input");
                            input1.type = "text";
                            input1.id = "cost";
                            input1.placeholder="initial cost";                          
                            var input2 = document.createElement("input");
                            input2.type = "text";
                            input2.id = "coststep";
                            input2.placeholder="cost step";
                            
                            node.appendChild(input1);
                            node.appendChild(input2);
                            node.appendChild(button);
                            document.getElementById("panel2").appendChild(node);
                            drawAppend = true;
                            }
                          
                      });
    
                                         
    // Add a store
    google.maps.event.addDomListener(control3, 'click', function() {
                            if(!addAppend){
                            if(drawAppend){
                            //REMOVE DRAW ELLIPSE ELEMENT
                            var div = document.getElementById("draw_ellipse");
                            if (div!=null){
                            var parent = document.getElementById("panel2");
                            parent.removeChild(div);
                            drawAppend = false;
                            }
                            }
                            //REMOVE STORE OPT ELEMENTs
                            document.getElementById("panel6").style.display = 'none';                         
                            //ADD NEW ELEMENTS
                            var node = document.createElement("DIV");
                            node.id = "add_node";
                            var button = document.createElement("BUTTON");
                            button.innerHTML = 'Add it';
                            button.id = "add";
                            button.onclick = function(){
                            addNode(map);
                              };
                            var lat = document.createElement("input");
                            lat.type = "text";
                            lat.placeholder="latitude";
                            lat.id = "lat";
                            var lng = document.createElement("input");
                            lng.type = "text";
                            lng.placeholder="longitude";
                            lng.id = "lng";
                            var weight = document.createElement("input");
                            weight.type = "text";
                            weight.placeholder="weight";
                            weight.id = "weight";
                            node.appendChild(lat);
                            node.appendChild(lng);
                            node.appendChild(weight);
                            node.appendChild(button);
                            document.getElementById("panel2").appendChild(node);
                            addAppend = true;
                            }
                                         });
                                          
    // Store opt
    google.maps.event.addDomListener(control4, 'click', function() {
                            if(drawAppend){
                            //REMOVE DRAW ELLIPSE ELEMENT
                            var div = document.getElementById("draw_ellipse");
                            if (div!=null){
                            var parent = document.getElementById("panel2");
                            parent.removeChild(div);
                            drawAppend = false;
                            }
                            }
                            if(addAppend){
                            //REMOVE ADD A NODE ELEMENTS
                            var div = document.getElementById("add_node");
                            if (div!=null){
                            var parent = document.getElementById("panel2");
                            parent.removeChild(div);
                            addAppend = false;
                            }                                
                            } 
                                         });
       // Find Average
    google.maps.event.addDomListener(control2, 'click', function() {                        
                            var node = getWeightedAverage(stores); 
                            oldAveMarker = aveMarker;
                            aveMarker = new google.maps.Marker({                              
                                     position: new google.maps.LatLng(node.getLat(), node.getLng()),
                                     draggable: false,
                                     map: map,
                                     icon:image1,
                                     title: 'Weighted Average',
                                     zIndex: AVE_ZINDEX,
                                     animation: google.maps.Animation.DROP,
                                     clickable:false
                                     });
                                     if(typeof(oldAveMarker) != "undefined"){
                                          oldAveMarker.setMap(null);
                                     }                         
                              });                                                              
                                         
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(control1);
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(control2);
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(control3);
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(control4);
}


    google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>

<body>
    <div id=inputs class=clearfix>
    <button type="button" id="imp_1" class="import-button" onclick="document.getElementById('files').click();">import 1</button>
    <div id="upload-wrap">
        <input type="file" id=files name=files[] />
    </div>
    </div>
    <div class="side-panel">
        <div id="panel1"></div>
        <div id="panel3"></div>
        <div id="panel44"></div>
        <div id="panel4"></div>
        <div id="panel55"></div>
        <div id="panel5"></div>
        <div id="panel99"></div>
        <div id="panel9"></div>
        <div id="panel2"></div>
        <div id="panel6"> 
            <div id="panel66">Store Optimization</div>
            Enter DC Location:<br>
            <input type="text" placeholder="latitude" id="dc-lat">
            <input type="text" placeholder="longitude" id="dc-lng">
            <button id="insert-dc" onclick="addDC(map)">Insert</button><br><br>
            <div id="panel7">Select the option: <br>
                <div class="styled-select">
                <select id="opts" onchange="selOption()">
                    <option>Remove next node</option>
                    <option>Add next node</option>  
                    <option>Store Grouping</option>
                  </select>
                  </div>
               <div id="panel8"><button id="opt1" onclick="bounceNextNode()">Find</button></div>
            </div>
        </div>
    </div>
    <div id="panel" style="margin-left: -52px"></div>
    <div id="map-canvas"></div>
    
</body>
</html>

