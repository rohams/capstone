<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="mystyle.css">
<script src="script.js"></script>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

<script type="text/javascript"
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxfWoChDI1GdE2uBRUcl17cbjocx6qcs0&sensor=false">
</script>


<script src="jquery.min.js"></script>
<script src="jquery.csv-0.71.js"></script>

<script>
  $(document).ready(function() {
    if(isAPIAvailable()) {
      $('#files').bind('change', handleFileSelect);
    }
  });

  function isAPIAvailable() {
    // Check for the various File API support.
    if (window.File && window.FileReader && window.FileList && window.Blob) {
      // Great success! All the File APIs are supported.
      return true;
    } else {
      // source: File API availability - http://caniuse.com/#feat=fileapi
      // source: <output> availability - http://html5doctor.com/the-output-element/
      document.writeln('The HTML5 APIs used in this form are only available in the following browsers:<br />');
      // 6.0 File API & 13.0 <output>
      document.writeln(' - Google Chrome: 13.0 or later<br />');
      // 3.6 File API & 6.0 <output>
      document.writeln(' - Mozilla Firefox: 6.0 or later<br />');
      // 10.0 File API & 10.0 <output>
      document.writeln(' - Internet Explorer: Not supported (partial support expected in 10.0)<br />');
      // ? File API & 5.1 <output>
      document.writeln(' - Safari: Not supported<br />');
      // ? File API & 9.2 <output>
      document.writeln(' - Opera: Not supported');
      return false;
    }
  }

  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object
    var file = files[0];

    // read the file metadata
    var output = ''
        output += '<span style="font-weight:bold;">' + escape(file.name) + '</span><br />\n';
        output += ' - FileType: ' + (file.type || 'n/a') + '<br />\n';
        output += ' - FileSize: ' + file.size + ' bytes<br />\n';
        output += ' - LastModified: ' + (file.lastModifiedDate ? file.lastModifiedDate.toLocaleDateString() : 'n/a') + '<br />\n';

    // read the file contents
    printTable(file);

    // post the results
    $('#list').append(output);
  }

  function printTable(file) {
    var reader = new FileReader();
    reader.readAsText(file);
    reader.onload = function(event){
      var csv = event.target.result;
      var data = $.csv.toArrays(csv);
      var html = '';
      for(var row in data) {
        html += '<tr>\r\n';
        for(var item in data[row]) {
          html += '<td>' + data[row][item] + '</td>\r\n';
        }
        html += '</tr>\r\n';
      }
      $('#contents').html(html);
    };
    reader.onerror = function(){ alert('Unable to read ' + file.fileName); };
  }
</script>







<script type="text/javascript">
    
    var vancouver = new google.maps.LatLng(49.265116, -123.136139);  
    var latitudes=[49.26399595412051,49.28437972233387,49.24203478303861,49.317513356758184];
    var longitudes=[-123.15914154052734,-123.12309265136719,-123.0743408203125,-123.12000274658203];
    var nodes = []; 
    
    for (i=0;i<latitudes.length;i++)
        {
            var store= new Node (latitudes[i], longitudes[i]);
            nodes.push(store);
        }
        
    //global variables
    var AVE_ZINDEX = 200;
    var addAppend = false;
    var drawAppend = false;
    var image1 = 'marker.png';
    var image2 = 'marker2.png';
    var geocoder;
    var aveMarker;
    var markers = [];
                  
    // initialize the map    
function initialize() {
    geocoder = new google.maps.Geocoder();
    
    //map options
    var mapOptions = {
    center: vancouver,
    zoom: 12,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    mapTypeControl: true,
    mapTypeControlOptions: {
    style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
    },
    navigationControl: true,
    navigationControlOptions: {
    style: google.maps.NavigationControlStyle.SMALL
    },
    streetViewControl: false,
    panControl: true,
    panControlOptions: {
    position: google.maps.ControlPosition.RIGHT_TOP,
    },
    zoomControl: true,
    zoomControlOptions: {
    style: google.maps.ZoomControlStyle.LARGE,
    position: google.maps.ControlPosition.RIGHT_TOP
    }
    };
    var map = new google.maps.Map(document.getElementById("map-canvas"),
                                  mapOptions);
                                  
      
        
   //set nodes
    google.maps.event.addListenerOnce(map, 'tilesloaded', addMarkers);

 
function addMarkers() {
    for (var i = 0; i < nodes.length; i++) {
    var marker = new google.maps.Marker({
                                        position: new google.maps.LatLng(nodes[i].getLat(), nodes[i].getLng()),
                                        draggable: true,
                                        map: map
                                        });
    markers.push(marker);
    }

}
    
    //set info window
    var infoWindow = new google.maps.InfoWindow();
    google.maps.event.addListener(map, 'click', function(event) {
                                  var html = '' + event.latLng;
                                  infoWindow.setContent(html);
                                  infoWindow.setPosition(event.latLng);
                                  infoWindow.open(map);
                                  });
             

// Sets the map on all markers in the array.
function setAllMap(map) {
  for (var i = 0; i < markers.length; i++) {
    markers[i].setMap(map);
  }
}

// Removes the markers from the map, but keeps them in the array.
function clearMarkers() {
  setAllMap(null);
}

// Shows any markers currently in the array.
function showMarkers() {
  setAllMap(map);
}

// Deletes all markers in the array by removing references to them.
function deleteMarkers() {
  clearMarkers();
  markers = [];
}                                
    

    //set controls
    var control1 = document.createElement('DIV');
    control1.style.padding = '5px';
    control1.style.border = '1px solid #000';
    control1.style.backgroundColor = 'white';
    control1.style.cursor = 'pointer';
    control1.innerHTML = 'Draw Ellipse';
    control1.title = 'draw cost based ellipse';
    control1.index = 1;

    var control2 = document.createElement('DIV');
    control2.style.padding = '5px';
    control2.style.border = '1px solid #000';
    control2.style.backgroundColor = 'white';
    control2.style.cursor = 'pointer';
    control2.innerHTML = 'Find Average';
    control2.title = 'mark the weighted average of the nodes';
    control2.index = 2;
    
    var control3 = document.createElement('DIV');
    control3.style.padding = '5px';
    control3.style.border = '1px solid #000';
    control3.style.backgroundColor = 'white';
    control3.style.cursor = 'pointer';
    control3.innerHTML = 'Add a Node';
    control3.title = 'Add a new node to the network';
    control3.index = 3;
    
    var control4 = document.createElement('DIV');
    control4.style.padding = '5px';
    control4.style.border = '1px solid #000';
    control4.style.backgroundColor = 'white';
    control4.style.cursor = 'pointer';
    control4.innerHTML = 'Import Data';
    control4.title = 'Import a CSV file';
    control4.index = 4;


    //draw ellipses
    google.maps.event.addDomListener(control1, 'click', function() {
                          var points = [];                         
                          if(!drawAppend){
                            var button = document.createElement("BUTTON");
                            button.innerHTML = 'Enter';
                            button.onclick = function(){
                            points = getEllipse(nodes, map);
                            //drawEllipse(map, points);
                              };
                            var input = document.createElement("input");
                            input.type = "text";
                            input.id = "cost";
                            input.placeholder="initial cost, e.g. 500";                          
                            var input2 = document.createElement("input");
                            input2.type = "text";
                            input2.id = "coststep";
                            input2.placeholder="cost step, e.g. 50";
                            document.getElementById("panel2").appendChild(input);
                            document.getElementById("panel2").appendChild(input2);
                            document.getElementById("panel2").appendChild(button);
                            drawAppend = true;
                            }
                          
                      });
    
    //Average finder
    google.maps.event.addDomListener(control2, 'click', function() {
                            var node = getAverage(nodes); 
                            oldAveMarker = aveMarker;
                            aveMarker = new google.maps.Marker({                              
                                     position: new google.maps.LatLng(node.getLat(), node.getLng()),
                                     draggable: false,
                                     map: map,
                                     icon:image1,
                                     title: 'Weighted Average',
                                     zIndex: AVE_ZINDEX,
                                     animation: google.maps.Animation.DROP
                                     });   
                            oldAveMarker.setMap(null);
                                         });
                                         
    // Add a node
    google.maps.event.addDomListener(control3, 'click', function() {
                            if(!addAppend){
                            var button = document.createElement("BUTTON");
                            button.innerHTML = 'Add';
                            button.onclick = function(){
                            codeLatLong(map);
                              };
                            var input = document.createElement("input");
                            input.type = "text";
                            input.value = "49.282812039212075,-123.08910369873047";
                            input.id = "latlng";
                            document.getElementById("panel3").appendChild(input);
                            document.getElementById("panel3").appendChild(button);
                            addAppend = true;
                            }
                                         });
                                                                        
                                         
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(control1);                                     
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(control2);
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(control3);
    }


    google.maps.event.addDomListener(window, 'load', initialize);
    
</script>
</head>

<body>
    <div id=inputs class=clearfix>
  <input type=file id=files name=files[] multiple />
</div>

    <div id="panel2"><div id="panel3"></div></div>   
    <div id="panel" style="margin-left: -52px"></div>
    <div id="map-canvas"/>


</body>
</html>

